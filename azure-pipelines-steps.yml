steps:

- task: CacheBeta@1
  inputs:
    key: $(CACHE_KEY)
    path: $(PACKAGES_PATH)
    cacheHitVar: CACHE_RESTORED
  displayName: 'Cache Nuget'

- script: dotnet --list-sdks
  
- task: DotNetCoreCLI@2
  inputs:
    command: 'restore'
    packagesDirectory: $(PACKAGES_PATH)
  displayName: 'dotnet restore'
  condition: ne(variables.CACHE_RESTORED, 'true')

- task: DotNetCoreCLI@2
  inputs:
    command: 'build'
    arguments: --packages $(PACKAGES_PATH)
  displayName: 'dotnet build $(buildConfiguration)'

- script: ls -l $(PACKAGES_PATH)